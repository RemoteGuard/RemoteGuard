<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RemoteGuard - Visualize, analise, transforme.</title>
  <link rel="stylesheet" href="../css/dashboard-teste-analista.css">
  <link rel="icon" href="../assets/imgs/logo4-amarela.svg">
</head>
<body>
  <header id="main-header">
    <div class="menu-icone" id="menu-icone">
      <img src="../assets/imgs/2.png" alt="Menu" class="menu-img">
    </div>
    <div class="perfil-wrapper">
      <div class="Ativacao">
        <button>Ajuda</button>
      </div>
      <div class="perfil-container">
        <img src="../assets/imgs/a.png" alt="Imagem de Perfil">
        <div class="perfil-text">
          <span class="nome">Analista</span>
          <span class="legenda">perfil</span>
        </div>
      </div>
    </div>
  </header>

  <nav id="menuhamburguer">
    <div class="logo">
      <img src="../assets/imgs/logo4-amarela.svg" alt="Logo">
    </div>
    <ul class="menu-items">
      <li class="ativo"><a href="DashAnalista.html"><img src="../assets/imgs/dash.png" alt="Ícone 1">Dashboard</a></li>
      <li class="naoAtivo"><a href="perfilAnalista.html"><img src="../assets/imgs/config.png" alt="Ícone 1">Configuração</a></li>
      <li class="naoAtivo"><a href="../login.html"><img src="../assets/imgs/sair.png" alt="Ícone 1">Sair</a></li>
    </ul>
  </nav>

  <main id="main-Container">
    <div class="controles">
      <select id="recurso">
        <option value="" selected disabled>Selecionar recurso</option>
        <option value="ram">Memória RAM</option>
        <option value="cpu">CPU</option>
        <option value="disco">Disco</option>
      </select>
    </div>
    
    <div class="dashboard">
      <div class="chart-container">
        <div class="mensagem-estilo2" id="mensagemAviso" style="color: red;">Por favor, selecione um recurso para visualizar os dados.</div>
        <canvas id="myChart"></canvas>
      </div>
      <div class="status-boxes">
        <div class="status-card verde"><span id="funcionario-ativo" class="text-card"></span></div>
        <div class="status-card vermelho"><span id="recurso-alerta" class="text-card"></span></div>
        <div class="status-card amarelo"><span id="processo-mais-utilizado" class="text-card"></span></div>
      </div>
    </div>

    <div class="cor-botoes">
      <div class="cor-box vermelho"></div>
      <div class="cor-box amarelo"></div>
      <div class="cor-box verde"></div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      let grafico;
    
      function definirRecurso(recursoSelecionado) {
        const endpoints = {
          ram: { endpoint: "/analista/listarPorcentagemRAM", label: "Memória RAM" },
          cpu: { endpoint: "/analista/listarPorcentagemCPU", label: "CPU" },
          disco: { endpoint: "/analista/listarPorcentagemDisco", label: "Disco" }
        };
      
        const recurso = endpoints[recursoSelecionado];
        if (!recurso) return; 
      
        document.getElementById('mensagemAviso').style.display = "none";
      
        if (recursoSelecionado === "disco") {
          buscarDadosDisco(recurso.endpoint);
        } else {
          buscarDadosGrafico(recurso.endpoint, recurso.label);
        }
      }
    
  
      function plotarGrafico(dados, labels, label) {
        const ctx = document.getElementById('myChart').getContext('2d');
        if (grafico) grafico.destroy(); 
        grafico = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: label,
              data: dados,
              borderColor: 'rgba(0, 0, 0,0.1)',
              backgroundColor: 'rgba(255, 224, 0, 0.6)',
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: `Utilização de ${label} (%)`,
                font: { size: 18 },
                color: '#fff'
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100
              }
            }
          }
        });
      }
    
      function plotarGraficoDisco(usoDisco) {
        const ctx = document.getElementById('myChart').getContext('2d');
        if (grafico) grafico.destroy();
        const livreDisco = 100 - usoDisco;
    
        grafico = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['Usado', 'Livre'],
            datasets: [{
              data: [usoDisco, livreDisco],
              backgroundColor: ['rgba(255,0,0,0.4)', 'rgba(0,128,0,0.4)'],
              borderColor: ['rgba(0,0,0)', 'rgba(0,0,0)'],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'top' },
              title: {
                display: true,
                text: 'Uso de Disco (%)',
                font: { size: 18 },
                color: '#fff'
              }
            }
          }
        });
      }
    
   
      function buscarDadosGrafico(endpoint, label) {
        fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ idUsuarioServer: sessionStorage.ID_USUARIO, fkNotebook: 1 })
        })
        .then(response => response.json())
        .then(resposta => {
          const dados = [];
          const labels = [];
      
          resposta.forEach(item => {
            if (label === "Memória RAM") {
              dados.push(item.porcentagem_ram);
            } else {
              dados.push(item.porcentagem_cpu);
            }
            labels.push(new Date(item.data_captura).toLocaleTimeString());
          });
      
          plotarGrafico(dados, labels, label);
        })
        .catch(() => {
          document.getElementById('mensagemAviso').textContent = "Erro ao carregar os dados. Tente novamente mais tarde.";
        });
      }
      
     
      function buscarDadosDisco(endpoint) {
        fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ idUsuarioServer: sessionStorage.ID_USUARIO, fkNotebook: 1 })
        })
        .then(response => response.json())
        .then(resposta => plotarGraficoDisco(resposta.porcentagem_disco))
        .catch(() => {
          document.getElementById('mensagemAviso').textContent = "Erro ao carregar os dados do disco.";
        });
      }
    
    
      document.getElementById('recurso').addEventListener('change', (event) => {
        const recursoSelecionado = event.target.value;
        definirRecurso(recursoSelecionado);
      });


      // Manipulação do menu hamburguer
    document.getElementById('menu-icone').addEventListener('click', function () {
      var menuhamburguer = document.getElementById('menuhamburguer');
      var mainContainer = document.getElementById('main-Container');
      var header = document.getElementById('main-header');

      // Alterna a classe 'open' para o menu e a 'menu-open' para o conteúdo e header
      menuhamburguer.classList.toggle('open');
      document.body.classList.toggle('menu-open');
    });

    const menuItems = document.querySelectorAll('.menu-items li');

    menuItems.forEach(item => {
      item.addEventListener('click', function () {
        // Remove a classe 'active' de todos os itens
        menuItems.forEach(el => el.classList.remove('active'));
        // Adiciona a classe 'active' ao item clicado
        this.classList.add('active');
      });
    });
    </script>
</body>
</html>
