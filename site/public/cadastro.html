<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro | RemoteGuard</title>
    <link rel="stylesheet" href="css/cadastro.css">
    <link rel="icon" href="img/svg/aguia2.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="container">
        <div class="cadastre_esquerda">
            <img  src="img/AguiaComOnome.png" alt="">
            <h1><br><b>Potencialize</b> a produtividade no trabalho remoto</h1>
            <h2>___________________________</h2>
            <button onclick="location.href='index.html'">Voltar ao Início</button>
        </div>
        <div class="cadastre">
            <div class="card">
                <div class="titleCad">Cadastre-se</div>
                <div class="inputs">
                    <div class="input-grupo">
                        <div class="input-caixa">
                            <label for="input_nome">Nome:</label>
                            <div class="input-field" id="nome_field">
                                <i class="fa-solid fa-user-large"></i>
                                <input type="text" id="input_nome" placeholder="Insira seu Nome">
                            </div>
                            <div id="nome-erro" class="mensagem-erro"></div>
                        </div>
                        <div class="input-caixa">
                            <label for="input_email">Email:</label>
                            <div class="input-field" id="email_field">
                                <i class="fa-solid fa-envelope"></i>
                                <input type="text" id="input_email" placeholder="Insira seu Email">
                            </div>
                            <div id="email-erro" class="mensagem-erro"></div>
                        </div>
                        </div>
                        <div class="input-grupo">
                        <div class="input-caixa">
                            <label for="input_senha">Senha:</label>
                            <div class="input-field" id="senha_field">
                                <i class="fa-solid fa-lock"></i>
                                <input type="password" id="input_senha" placeholder="Insira sua Senha">
                                <i class="fa-solid fa-eye" id="showPassword" onclick="showPassword()"></i>
                            </div>
                            <div id="senha-erro" class="mensagem-erro"></div>
                        </div>
                        <div class="input-caixa">
                            <label for="input_cpf">CPF:</label>
                            <div class="input-field" id="cpf_field">
                                <i class="fas fa-id-card"></i>
                                <input type="text" id="input_CPF" placeholder="Insira seu CPF">
                            </div>
                            <div id="CPF-erro" class="mensagem-erro"></div>
                        </div>
                     </div>
                        <div class="input-grupo">
                        <div class="input-caixa">
                            <label for="select_empresa">Empresa:</label>
                            <div class="input-field" id="empresa_field">
                                <i class="fas fa-building"></i>
                                <select id="select_empresa" class="select-empresa">
                                    <option selected disabled value="#">Selecione a Empresa</option>
                           
                                </select>
                            </div>
                            <div id="empresa-erro" class="mensagem-erro"></div>
                        </div>
                        <div class="input-caixa">
                            <label for="select_funcao">Cargo:</label>
                            <div class="input-field_cargo" id="funcao_field">
                                <i class="fas fa-user-tie"></i>
                                <select id="select_funcao" disabled>
                                    <option value="#">Selecione seu Cargo</option>
                                    <option value="tecnico" selected>Gerente</option>
                                    <option value="arquiteto" disabled>tecnico</option>
                                </select>
                            </div>
                        </div>
                            <div id="funcao-erro" class="mensagem-erro"></div>
                        </div>
                        <button onclick="cadastrar()">Cadastrar</button>
                        <span class="possui_cadastro">Já possui Cadastro? <a href="login.html" class="possui_cadastro_a"> Fazer Login</a></span>
                    </div>
                    </div>
    </div>
</body>

</html>
<script>

    function showPassword() {
        if (document.getElementById("showPassword").classList.contains("fa-eye")) {
            document.getElementById("showPassword").classList.remove("fa-eye");
            document.getElementById("showPassword").classList.add("fa-eye-slash");
            input_senha.type = "text";
        }
        else {
            document.getElementById("showPassword").classList.remove("fa-eye-slash");
            document.getElementById("showPassword").classList.add("fa-eye");
            input_senha.type = "password";
        }
    }
    function alterarSidebar() {
        let menu = document.querySelector('.headerBarResp');
        // alert("Ativado")

        if(menu.style.width == '50%'){
            menu.style.width = '0%'
        } else{
            menu.style.width = '50%'
        }
    }

    function cadastrar() {
        var nome = input_nome.value;
        var email = input_email.value;
        var senha = input_senha.value;
        var cargo = input_cargo.value;
        var nomeEmpresa = input_empresa.value;
        var cpf = input_cpf.value;


        // var caixaAltaNome = nome.toUperCase();
        var caixaBaixaEmail = email.toLowerCase();
        var caixaBaixaEmpresa = nomeEmpresa.toLowerCase();

        var tamanhoSenha = senha.length;

        var cpfTamanho = cpf.length;
        var senhaTamanho = senha.length;

        var indiceArrobaSenha = senha.indexOf('@');
        var indiceHashtagSenha = senha.indexOf('#');
        var indiceCifraoSenha = senha.indexOf('$');
        var indiceComercialSenha = senha.indexOf('&');

        var indiceArrobaEmail = email.indexOf('@');
        var indicePontoEmail = email.indexOf('.');

        var fazerCadastro = true;

        div_mensagem.innerHTML = ` `;

        // if (nome == "" ||
        //     email == "" ||
        //     senha == "" ||
        //     cargo == "" ||
        //     nomeEmpresa == 0 ||
        //     cpf == ""
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Todos os campos devem estar preenchidos!</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (indiceArrobaSenha < 0 &&
        //     indiceCifraoSenha < 0 &&
        //     indiceComercialSenha < 0 &&
        //     indiceHashtagSenha < 0
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Senha inválida, tente novamente! (a senha precisa ter pelo menos 1 caractere especial entre essas opções: (@ - # - $ - &))</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (cpfTamanho != 11
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - CPF inválido, tente novamente! (quantidade de dígitos errada)</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (senha != null // Ajustar a criação de variável
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Senha e senha de confirmação diferentes! Tente novamente</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (tamanhoSenha < 5 ||
        //     tamanhoSenha > 15
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Senha inválida, tente novamente! (a senha precisa ter pelo menos 5 caracteres e no máximo 15 caracteres)</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (indiceArrobaEmail < 0 ||
        //     indicePontoEmail < 0
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Email inválido, tente novamente! (o email precisa ter "@" e ".")</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // O fetch só pode ser realizado se os dados inseridos não passarem em todos os ifs, validando através da variável fazerCadastro. 
        if (fazerCadastro) {
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    nomeServer: nome,
                    emailServer: email,
                    senhaServer: senha
                }),
            })
                .then(function (resposta) {
                    console.log(`Resposta da requisição: ${JSON.stringify(resposta)}`);
                    if (resposta.ok) {
                        alert("Cadastro feito com sucesso");
                        resposta.json().then(json => {
                            console.log(JSON.stringify(json));
                        });
                        setTimeout(() => {
                            window.location.href = "./login.html"
                        }, 1000);
                    } else {
                        resposta.json().then(json => {
                            console.log(JSON.stringify(json));
                            // O método includes busca uma substring dentro de um string, ou seja, se o SQL retornar a mensagem "Duplicate entry" ele entra no if
                            if(JSON.stringify(json).includes("Duplicate entry")){
                                alert("O email utilizado já existe no sistema");
                            }
                        });
                        // alert('Não foi possível cadastrar o usuário');
                        console.log("Houve um erro ao tentar realizar o login!");
                    }
                }).catch(function (erro) {
                    console.log(erro);
                })
        }

    }

    let menu = document.querySelector('#divLinksLogin');

    function showMain(){
        menu.style.display = 'flex';
        clearTimeout(tempo_espera);
    }
    function hiddeMain(){
            tempo_espera = setTimeout(function(){
            menu.style.display = 'none';
        }, 1000);
    }



</script>
</script>