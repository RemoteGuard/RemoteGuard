<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro | RemoteGuard</title>
    <link rel="stylesheet" href="css/cadastro.css">

    <link rel="icon" href="img/svg/aguia2.svg">
</head>

<body>
    <header>
        <div class="headerLogo">
            <a href="index.html">
                <img src="img/svg/aguia2.svg" alt="">
                <h1>Remote Guard</h1>
            </a>
        </div>
        <ul class="headerBar">
            <li>
                <a href="index.html">Home</a>
            </li>
            <li>
                <a href="#">Sobre nós</a>
            </li>
            <li>
                <a href="#">Demonstração</a>
            </li>
            <li class="areaCliente" onmouseover="showMain()" onmouseleave="hiddeMain()">
                <div class="botaoAreaCliente">
                    <a>Área do cliente</a>
                </div>
                <div id="divLinksLogin" class="linksLogin">
                    <div>
                        <a href="#">Login</a>
                    </div>
                    <div class="ultimoLink">
                        <a href="#">Cadastro</a>
                    </div>
                </div>
            </li>

        </ul>

    </header>
    <div class="container">
        <div class="cadastre">
            <div class="titleCad">Cadastro</div>
            <div class="card">
                <h2>Cadastre-se e Aproveite</h2>
                <div class="formulario">
                    <div class="campo">
                        <input type="text" id="input_nome" placeholder="Nome">
                        <input type="email" id="input_email" placeholder="E-mail">
                        <input type="password" id="input_senha" placeholder="Senha">
                    </div>
                    <div class="campo">
                        <input type="text" id="input_cargo" placeholder="Cargo">
                        <input type="text" id="input_empresa" placeholder="Empresa">
                        <input type="password" id="input_cpf" placeholder="CPF">
                    </div>
                </div>
                <div class="botao">
                    <button onclick="cadastrar()" style="color: antiquewhite; font-size: medium;">Cadastrar</button>
                </div>

                <div id="div_mensagem"></div>
            </div>
        </div>
    </div>
</body>

</html>
<script>

    function cadastrar() {
        var nome = input_nome.value;
        var email = input_email.value;
        var senha = input_senha.value;
        var cargo = input_cargo.value;
        var nomeEmpresa = input_empresa.value;
        var cpf = input_cpf.value;


        // var caixaAltaNome = nome.toUperCase();
        var caixaBaixaEmail = email.toLowerCase();
        var caixaBaixaEmpresa = nomeEmpresa.toLowerCase();

        var tamanhoSenha = senha.length;

        var cpfTamanho = cpf.length;
        var senhaTamanho = senha.length;

        var indiceArrobaSenha = senha.indexOf('@');
        var indiceHashtagSenha = senha.indexOf('#');
        var indiceCifraoSenha = senha.indexOf('$');
        var indiceComercialSenha = senha.indexOf('&');

        var indiceArrobaEmail = email.indexOf('@');
        var indicePontoEmail = email.indexOf('.');

        var fazerCadastro = true;

        div_mensagem.innerHTML = ` `;

        // if (nome == "" ||
        //     email == "" ||
        //     senha == "" ||
        //     cargo == "" ||
        //     nomeEmpresa == 0 ||
        //     cpf == ""
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Todos os campos devem estar preenchidos!</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (indiceArrobaSenha < 0 &&
        //     indiceCifraoSenha < 0 &&
        //     indiceComercialSenha < 0 &&
        //     indiceHashtagSenha < 0
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Senha inválida, tente novamente! (a senha precisa ter pelo menos 1 caractere especial entre essas opções: (@ - # - $ - &))</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (cpfTamanho != 11
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - CPF inválido, tente novamente! (quantidade de dígitos errada)</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (senha != null // Ajustar a criação de variável
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Senha e senha de confirmação diferentes! Tente novamente</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (tamanhoSenha < 5 ||
        //     tamanhoSenha > 15
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Senha inválida, tente novamente! (a senha precisa ter pelo menos 5 caracteres e no máximo 15 caracteres)</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // if (indiceArrobaEmail < 0 ||
        //     indicePontoEmail < 0
        // ) {
        //     div_mensagem.innerHTML =
        //         `<span style="color: yellow;"> - Email inválido, tente novamente! (o email precisa ter "@" e ".")</span><br><br>`;
        //     fazerCadastro = false;
        //     return false;
        // }

        // O fetch só pode ser realizado se os dados inseridos não passarem em todos os ifs, validando através da variável fazerCadastro. 
        if (fazerCadastro) {
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    nomeServer: nome,
                    emailServer: email,
                    senhaServer: senha
                }),
            })
                .then(function (resposta) {
                    console.log(`Resposta da requisição: ${JSON.stringify(resposta)}`);
                    if (resposta.ok) {
                        alert("Cadastro feito com sucesso");
                        resposta.json().then(json => {
                            console.log(JSON.stringify(json));
                        });
                        setTimeout(() => {
                            window.location.href = "./login.html"
                        }, 1000);
                    } else {
                        resposta.json().then(json => {
                            console.log(JSON.stringify(json));
                            // O método includes busca uma substring dentro de um string, ou seja, se o SQL retornar a mensagem "Duplicate entry" ele entra no if
                            if(JSON.stringify(json).includes("Duplicate entry")){
                                alert("O email utilizado já existe no sistema");
                            }
                        });
                        // alert('Não foi possível cadastrar o usuário');
                        console.log("Houve um erro ao tentar realizar o login!");
                    }
                }).catch(function (erro) {
                    console.log(erro);
                })
        }

    }

    let menu = document.querySelector('#divLinksLogin');

    function showMain(){
        menu.style.display = 'flex';
        clearTimeout(tempo_espera);
    }
    function hiddeMain(){
            tempo_espera = setTimeout(function(){
            menu.style.display = 'none';
        }, 1000);
    }



</script>
</script>