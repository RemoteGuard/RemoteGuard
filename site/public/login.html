<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | RemoteGuard</title>
    <link rel="stylesheet" href="css/login.css">
    <link rel="icon" href="img/svg/aguia2.svg">
</head>

<body>
    <header>
        <div class="headerLogo">
            <a href="index.html">
                <img src="img/svg/aguia2.svg" alt="">
                <h1>Remote Guard</h1>
            </a>
        </div>
        <ul class="headerBar">
            <li>
                <a href="index.html">Home</a>
            </li>
            <li>
                <a href="#">Sobre nós</a>
            </li>
            <li>
                <a href="#">Demonstração</a>
            </li>
            <li class="areaCliente" onmouseover="showMain()" onmouseout="hiddeMain()">
                <div class="botaoAreaCliente">
                    <a>Área do cliente</a>
                </div>
                <div id="divLinksLogin" class="linksLogin">
                    <div>
                        <a href="#">Login</a>
                    </div>
                    <div class="ultimoLink">
                        <a href="./cadastro.html">Cadastro</a>
                    </div>
                </div>
            </li>

        </ul>

    </header>
    <div class="container">
        <div class="cadastre">
            <div class="titleLog">Login</div>
            <div class="card">
                <h2>Bem-vindo de volta!</h2>
                <div class="formulario">
                    <div class="campo">
                        <input type="text" id="input_email" placeholder="E-mail">
                        <input type="password" id="input_senha" placeholder="Senha">
                    </div>
                </div>
                <div class="botao">
                    <button onclick="autenticar()" style="color: antiquewhite; font-size: medium;">Login</button>
                </div>

                <div id="div_mensagem"></div>
            </div>
        </div>
    </div>
</body>

</html>
<script>

    var tentativas = 3;
    var sendEmail = '';
    var sendSenha = '';

    function autenticar() {
        // aguardar();

        var email = input_email.value;
        var senha = input_senha.value;
        sendEmail = email;
        sendSenha = senha;

        if (email == "" || senha == "") {
            div_mensagem.innerHTML = `<span style="color: yellow;"> - Todos os campos devem estar preenchidos!</span><br><br>`;
            finalizarAguardar();
            return false;
        }

        console.log("FORM LOGIN: ", email);
        console.log("FORM SENHA: ", senha);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: sendEmail,
                senhaServer: sendSenha
            })
        }).then(function (resposta) {
            console.log(`Resposta da requisição: ${JSON.stringify(resposta)}`);

            if (resposta.ok) {
                alert("Autenticação feita com sucesso");
                resposta.json().then(json => {
                    console.log(JSON.stringify(json));
                    sessionStorage.EMAIL_USUARIO = json.data.email;
                    sessionStorage.ID_USUARIO = json.data.id;
                });

            } else {
                alert('Usuário não encontrado!');
                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    // finalizarAguardar(texto);
                });
            }
        }).catch(function (erro) {
            console.log(erro);
        })

    }

    let menu = document.querySelector('#divLinksLogin');

    function showMain() {
        menu.style.display = 'flex';
    }
    function hiddeMain() {
        menu.style.display = 'none';
    }
</script>